## Тест‑план перед сдачей заказчику

Этот документ описывает основные пользовательские сценарии, которые нужно проверить
перед передачей приложения заказчику. Следуйте шагам по порядку и фиксируйте результат
для каждого кейса.

---

## 0. Подготовка

- Убедитесь, что установлен `ffmpeg` и он доступен в PATH.
- Запустите приложение.
- Подготовьте 3–5 видеофайлов:
  - короткий (10–30 сек),
  - длинный (5–10 мин),
  - файл с другим расширением (например, mp4, mkv, mov).
- Подготовьте файл с необычным именем (пробелы, кириллица).

---

## 1. Запуск и базовый UI

1. Откройте приложение.
2. Убедитесь, что **лог выполнения** отображается сразу.
3. Убедитесь, что **редактор пресетов** виден сразу.
4. Убедитесь, что таблица очереди без файлов:
   - нет горизонтального скролла,
   - колонка "Открыть" не обрезана.

---

## 2. Добавление файлов в очередь

1. Нажмите "Добавить файлы..." и выберите 2–3 файла.
2. Проверьте:
   - файлы появляются в таблице,
   - появляется нумерация строк,
   - ширины колонок не "съезжают".
3. Выберите файл с пробелами/кириллицей — отображается корректно.

---

## 3. Выбор файлов и отображение команды

1. Выберите 1 файл в очереди.
2. Команда FFmpeg должна появиться в поле команды.
3. Измените CRF/Bitrate/FPS — команда должна обновиться.
4. Выберите 2 файла сразу:
   - поле команды очищается/становится read‑only,
   - предпросмотр видео останавливается.

---

## 4. Контейнеры, кодеки, разрешения

Проверьте для каждого блока:

### 4.1 Контейнеры

1. Переключите контейнер: mp4 → mov → mkv → avi → mxf.
2. Убедитесь, что меняется расширение выходного файла.
3. Выберите Custom → добавьте новый (например, webm) → сохраните.
4. Убедитесь, что custom контейнер сохраняется и повторно доступен.

### 4.2 Видео‑кодеки

1. Переключите libx264 / libx265 / prores / copy.
2. Убедитесь, что команда содержит `-c:v ...` (кроме "current").
3. Custom → добавьте новый кодек и убедитесь, что он сохраняется.

### 4.3 Разрешение

1. Выберите 720p / 1080p / 2k / 4k.
2. Убедитесь, что команда содержит `-vf scale=...`.
3. Custom → добавьте новое разрешение (например 1024:576) → сохраните.

---

## 5. Аудио‑кодеки

1. Переключайте current / aac / mp3 / pcm_s16le / pcm_s24le / custom.
2. Проверьте, что команда содержит `-c:a ...` (current → copy).
3. Custom → добавьте кодек (например, libopus) → сохраните.

---

## 6. Основные параметры (CRF, Bitrate, FPS, Audio, Preset)

1. Установите:
   - CRF = 23
   - Bitrate = 2500
   - FPS = 25
   - Audio bitrate = 192
   - Sample rate = 48000
2. Убедитесь, что команда содержит:
   - `-crf 23`
   - `-b:v 2500k`
   - `-r 25`
   - `-b:a 192k`
   - `-ar 48000`
3. Preset speed → `fast`, `medium`, `slow`:
   - убедитесь, что команда содержит `-preset fast|medium|slow`
4. Threads → значение >0:
   - команда содержит `-threads N`

---

## 7. Доп. параметры

1. Profile/Level → `high:4.1`:
   - команда содержит `-profile:v high -level 4.1`
2. Pixel format → `yuv420p`:
   - команда содержит `-pix_fmt yuv420p`
3. Tune → `film`:
   - команда содержит `-tune film`
4. Keyint → 250:
   - команда содержит `-g 250`
5. Галочки:
   - `-tag:v hvc1` добавляется
   - `:flags=lanczos` добавляется к текущему scale

---

## 8. Copy‑режимы

1. Video codec = copy:
   - убедитесь, что не добавляются `-vf`, `-crf`, `-b:v`
2. Audio codec = current (copy):
   - убедитесь, что не добавляются `-b:a`, `-ar`
3. Проверьте, что команда не падает с ошибкой из‑за несовместимых флагов.

---

## 9. Presets: создание, сохранение, применение

1. Настройте параметры (CRF, bitrate, FPS, codec, audio и т.д.).
2. Создайте пресет → проверьте появление в таблице.
3. Измените параметры и нажмите "Сохранить пресет":
   - убедитесь, что пресет обновился и содержит новые значения.
4. Выберите файл в очереди, нажмите "Применить" на пресете:
   - параметры должны примениться,
   - команда пересчитаться.

---

## 10. Preset +extra (пользовательские параметры)

1. Измените параметры UI и сгенерируйте команду.
2. Вручную добавьте в команду дополнительные флаги (например `-movflags +faststart`).
3. Нажмите кнопку "Сохранить пресет с пользовательскими параметрами".
4. В таблице пресетов рядом с именем должен появиться `+extra`.
5. Примените этот пресет — команда должна содержать доп. параметры.

---

## 11. Сохранение команд (save/load/delete)

1. Нажмите "Сохранить команду" — укажите имя.
2. Нажмите "Загрузить команду" — выберите сохранённую:
   - команда подставляется в поле,
   - preset становится custom.
3. Нажмите "Удалить команду" — убедитесь, что команда исчезла из списка.

---

## 12. Импорт / экспорт

### Экспорт

1. Нажмите "Экспорт":
   - выберите "Пресеты" → сохраните файл.
   - выберите "Команды FFmpeg" → сохраните файл.
   - выберите "Кастомные параметры" → сохраните файл.

### Импорт

1. Нажмите "Импорт":
   - выберите файл пресетов → убедитесь, что слияние прошло и ваши поля не потерялись.
   - выберите файл команд → команды добавились.
   - выберите файл кастомных параметров → элементы появились в списках custom.

---

## 13. Очередь и обработка

1. Добавьте несколько файлов.
2. Проверьте сортировку вверх/вниз.
3. Запустите кодирование:
   - прогресс обновляется,
   - статус меняется (waiting → processing → success/error),
   - лог пишется.
4. Проверка паузы:
   - нажмите "Пауза" → убедитесь, что процесс остановился и можно продолжить.

---

## 14. Обрезка / таймлайн

1. Перемещайте слайдер — корректно перематывается.
2. Нажмите In / Out → добавьте keep‑области.
3. Проверьте:
   - отображение сегментов на полоске.
   - результат команды при наличии сегментов.

---

## 15. Проверка ошибок

1. Укажите несуществующий входной файл:
   - должно быть сообщение об ошибке.
2. Попробуйте запустить кодирование без файлов:
   - должно быть уведомление.
3. Попробуйте сохранить/загрузить пресет без выбора:
   - должна быть корректная ошибка.

---

## Итог

Перед сдачей заказчику убедитесь, что:

1. Все команды формируются корректно.
2. Все параметры UI реально влияют на FFmpeg.
3. Сохранение/загрузка пресетов, команд и кастомных параметров работает.
4. Нет сбоев при кодировании и лог пишется правильно.
