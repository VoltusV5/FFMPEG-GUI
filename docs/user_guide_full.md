# User Guide (Full)

# User Guide (Full)

## Оглавление

# User Guide (Full)

## Оглавление

- [Обзор](#обзор)
- [Требования](#требования)
- [Запуск](#запуск)
- [Основной интерфейс](#основной-интерфейс)
- [Работа с очередью](#работа-с-очередью)
- [Предпросмотр и обрезка](#предпросмотр-и-обрезка)
- [Редактор пресетов](#редактор-пресетов)
- [Пресеты](#пресеты)
- [Команда FFmpeg](#команда-ffmpeg)
- [Импорт и экспорт](#импорт-и-экспорт)
- [Пользовательские списки](#пользовательские-списки)
- [Вкладка «Видео в аудио»](#вкладка-видео-в-аудио)
- [Вкладка «Аудио конвертер»](#вкладка-аудио-конвертер)
- [Имена выходных файлов](#имена-выходных-файлов)
- [Прогресс и логирование](#прогресс-и-логирование)
- [Предупреждения и ошибки](#предупреждения-и-ошибки)

---

(дальше идёт ваш текущий текст)

## Обзор

FFMPEG GUI — графическое приложение для конвертации видео и аудио с помощью FFmpeg.
Поддерживает очередь файлов, пресеты, предпросмотр, обрезку и склейку фрагментов,
а также вспомогательные вкладки для конвертации видео в аудио и аудио в другой формат.

Основные возможности:

- Очередь конвертаций с прогрессом и логами.
- Пресеты с расширенными параметрами кодирования.
- Предпросмотр, обрезка и склейка сегментов.
- Редактирование и сохранение команд FFmpeg.
- Экспорт/импорт пресетов и сохранённых команд.

## Требования

- Python 3.13+ (для запуска из исходников).
- PySide6.
- FFmpeg (`ffmpeg.exe` рядом с приложением или в PATH).
- FFprobe (`ffprobe.exe` рядом с приложением или в PATH) — опционально, но рекомендуется для точного прогресса.

Инструкция по установке FFmpeg:

- Заходим на официальный сайт ffmpeg [https://ffmpeg.org/download.html](https://ffmpeg.org/download.html)
- наводимся на значок Windows -> windows builds from gyan.dev (https://www.gyan.dev/ffmpeg/builds/)
- листаем ниже до "release builds" -> [https://github.com/GyanD/codexffmpeg/releases/](https://github.com/GyanD/codexffmpeg/releases/tag/8.0.1)
- скачиваем билд [ffmpeg-8.0.1-essentials_build.zip](https://github.com/GyanD/codexffmpeg/releases/download/8.0.1/ffmpeg-8.0.1-essentials_build.zip)
- после скачивания распаковываем
- заходим в папку bin
- копируем ffprobe.exe и ffmpeg.exe в корень FFMPEG GUI

## Запуск

1. Установите зависимости: `pip install -r requirements.txt`
2. Запустите приложение: `python main.py`

При первом запуске приложение может показать предупреждения:

- **FFmpeg не найден** — конвертация невозможна.
- **FFprobe не найден** — прогресс может быть менее точным.
- **Настройки не сохраняются** — у папки приложения нет прав на запись.

## Основной интерфейс

Приложение состоит из вкладок:

- **Очередь кодирования** — основной режим работы.
- **Видео в аудио** — быстрое извлечение аудио из видео.
- **Аудио конвертер** — конвертация аудиофайлов.

### Очередь кодирования

Основные элементы:

- Таблица очереди.
- Редактор пресетов и параметров.
- Поле команды FFmpeg.
- Логи FFmpeg.
- Прогресс текущего файла и общий прогресс очереди.

## Работа с очередью

### Добавление файлов

- Нажмите **Добавить файлы...** и выберите видеофайлы.
- Или перетащите файлы в таблицу очереди (drag-and-drop).

Поддерживаемые расширения:
`mp4`, `mkv`, `avi`, `mov`, `flv`, `wmv`.

### Выбор файла

Кликните по строке в таблице — файл будет загружен в предпросмотр,
а параметры и команда FFmpeg обновятся под выбранный элемент.

### Удаление файлов

Выделите файл и нажмите **Удалить**.

Ограничения:

- Во время кодирования удалить файл нельзя.
- При паузе нельзя удалять файлы, которые уже перекодированы.

### Перемещение по очереди

Используйте кнопки **Вверх/Вниз**.

### Запуск кодирования

Нажмите **Запустить кодирование**.

Во время работы:

- Кнопка меняется на **Завершить кодирование**.
- Доступна кнопка **Пауза**.
- Лог обновляется в реальном времени.

### Пауза и завершение

- **Пауза**: текущий файл отменяется, очередь ставится на ожидание.
- **Возобновить**: очередь запускается с файла, где была пауза.
- **Завершить кодирование**: сбрасывает очередь в ожидание.

## Предпросмотр и обрезка

### Видеоплеер

Доступны базовые элементы управления:

- Play/Pause
- Перемотка по таймлайну
- Предыдущий/следующий кадр
- Вкл/выкл звук

### Обрезка

Используйте кнопки:

- **In** — установить начало сегмента.
- **Out** — установить конец сегмента.

### Склейка сегментов

Нажмите **Добавить область** — текущий сегмент добавится в список для склейки.

Важно:

- При склейке нескольких сегментов аудио перекодируется в AAC.
- Если у файла нет аудио, результат будет без звука.
- При склейке нельзя использовать режим копирования аудио.

## Редактор пресетов

### Основные параметры

- **Кодек**: current / copy / libx264 / libx265 / custom.
- **Контейнер**: current / mp4 / mkv / mov / custom.
- **Разрешение**: current / 480p / 720p / 1080p / custom.

### Дополнительные параметры

В редакторе доступны дополнительные настройки:

- CRF
- Битрейт видео
- FPS
- Битрейт аудио
- Частота дискретизации
- Preset speed
- Profile/Level
- Pixel format
- Tune
- Threads
- Keyint
- Tag hvc1
- Lanczos масштабирование

### Предупреждения в редакторе

Приложение показывает предупреждения, если параметры конфликтуют:

- **Copy видео**: фильтры/CRF/битрейт/FPS игнорируются.
- **Copy аудио**: аудио‑битрейт/частота игнорируются.
- **Tag hvc1**: применим только для HEVC в MP4/MOV/M4V.
- **Склейка сегментов**: аудио перекодируется в AAC.

## Пресеты

### Системные пресеты

- **default** — перекодирование без изменения параметров (с новым именем файла).
- **custom** — пользовательские параметры для конкретного файла.

### Создание пресета

1. Настройте параметры.
2. Нажмите **Создать пресет**.
3. Введите имя и описание.

### Редактирование пресета

1. Выберите пресет в таблице.
2. Измените параметры.
3. Нажмите **Сохранить пресет**.

### Пресет с дополнительными параметрами

Если вы вручную отредактировали команду FFmpeg и хотите сохранить только
дополнительные аргументы:

1. Отредактируйте команду в поле FFmpeg.
2. Нажмите **Сохранить пресет (+ extra)**.
3. Пресет сохранит базовые параметры из UI и добавит extra‑args.

## Команда FFmpeg

### Поле команды

Поле показывает итоговую команду, которая будет запущена для выбранного файла.

- При изменении параметров команда пересчитывается автоматически.
- При ручном редактировании файл помечается как **custom**.
- Команда применяется только к текущему выбранному элементу очереди.

### Копирование

Кнопка **Копировать команду** копирует текущую команду в буфер обмена.

### Сохранённые команды

Можно сохранить команду как шаблон и применять к другим файлам:

- **Сохранить команду** — сохранить текущую команду в список.
- **Загрузить команду** — применить сохранённую команду к выбранному файлу.
- **Удалить команду** — удалить команду из списка.

При применении команды пути входного/выходного файла обновляются автоматически.

## Импорт и экспорт

В редакторе пресетов доступны:

- **Экспорт пресетов** — выгрузка пресета в XML.
- **Импорт пресетов** — загрузка пресета из XML.
- **Экспорт команд** — выгрузка списка сохранённых команд.
- **Импорт команд** — загрузка команд из файла.
- **Импорт/экспорт кастомных параметров** — списки контейнеров/кодеков.

## Пользовательские списки

В UI доступны кастомные значения:

- Контейнеры
- Кодеки
- Разрешения
- Аудио‑кодеки

Эти списки сохраняются между запусками в `presets/custom_options.json`.

## Вкладка "Видео в аудио"

Эта вкладка предназначена для быстрого извлечения аудио из видеофайла.

Порядок работы:

1. Выберите видеофайл.
2. Выберите формат (MP3, WAV, M4A, FLAC, OGG).
3. Выберите качество (copy / 64 / 128 / 192 / 320 kbps).
4. Нажмите **Конвертировать**.

Выходной путь формируется автоматически на основе выбранного формата.

## Вкладка "Аудио конвертер"

Позволяет конвертировать аудиофайлы в другой формат.

Порядок работы:

1. Добавьте один или несколько аудиофайлов.
2. Выберите формат выхода (например, MP3/WAV/FLAC).
3. Нажмите **Конвертировать**.

## Имена выходных файлов

По умолчанию выходной файл создаётся рядом с исходным:

- `input.mp4` → `input_converted.mp4`

Если файл с таким именем уже существует, автоматически добавляется суффикс:

- `input_converted_1.mp4`, `input_converted_2.mp4`, и т.д.

Если пользователь сам выбрал выходной файл, приложение использует `-y`
и перезаписывает файл.

## Прогресс и логирование

Приложение показывает:

- Прогресс текущего файла.
- Общий прогресс очереди.
- Лог FFmpeg с подсветкой ошибок и прогресса.

Если доступен `ffprobe`, прогресс рассчитывается точнее (по длительности/кадрам).

Прогресс рассчитывается:

- по количеству просчитанных кадров, если удалось получить эту информацию
- иначе по длительности видео,
- иначе по количеству файлов.

## Предупреждения и ошибки

### FFmpeg не найден

Кодирование невозможно. Положите `ffmpeg.exe` рядом с приложением
или добавьте в PATH.

### FFprobe не найден

Прогресс может быть менее точным, но кодирование работает.

### Ошибка записи настроек

Если папка приложения защищена, файлы настроек не смогут сохраниться:

- `presets/custom_options.json`
- `presets/saved_commands.json`
- `presets/presets.xml`

Решение: запускать приложение из каталога с правами на запись.
